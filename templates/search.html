<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>검색 결과 - {{ search_query }}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <h4>🔍 "{{ search_query }}" 검색 결과</h4>
  <div class="row" id="product-list">
    {% include "_product_cards.html" %}
  </div>
  <div id="loading" class="text-center my-4" style="display:none;">
    <div class="spinner-border"></div>
  </div>
</div>

<script>
let currentPage = 1;
let loading = false;

window.addEventListener('scroll', () => {
  if (loading) return;
  if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
    loading = true;
    document.getElementById('loading').style.display = 'block';
    currentPage++;

    fetch(`/search?q={{ search_query }}&page=${currentPage}`, { headers: { "X-Requested-With": "XMLHttpRequest" } })
      .then(res => res.text())
      .then(html => {
        document.getElementById('product-list').insertAdjacentHTML('beforeend', html);
        document.getElementById('loading').style.display = 'none';
        loading = false;
      });
  }
});
</script>
</body>
</html>
